<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ðŸ§¹ Data Cleaning Notebook</title>
    <link rel="icon" href="https://jupyter.org/favicon.ico" />
  </head>
  <body style="margin:0;padding:0;height:100vh;">
    <iframe id="lite" style="width:100%;height:100%;border:none;"></iframe>

    <script>
      const backendURL = "https://notebook-mirror.onrender.com/upload";

      // è¿™é‡ŒåŠ è½½å†…ç½® task.ipynbï¼ˆæ‰“åŒ…åœ¨ Pyodide FS å†…ï¼‰
      const src = "build/lab/index.html?path=task.ipynb";
      document.getElementById("lite").src = src;

      // è‡ªåŠ¨ä¿å­˜åˆ°åŽç«¯
      const participantID = "user_" + Math.random().toString(36).slice(2, 8);
      window.addEventListener("message", async (event) => {
        if (!event?.data || !event.data.content) return;
        if (event.data.type !== "notebookSaved") return;
        try {
          await fetch(backendURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              participant_id: participantID,
              notebook_json: JSON.stringify(event.data.content),
            }),
          });
          console.log("âœ… Saved to backend");
        } catch (e) {
          console.error("âŒ Upload failed:", e);
        }
      });

      // æ¯åˆ†é’Ÿè‡ªåŠ¨è§¦å‘ä¸€æ¬¡ save
      setInterval(() => {
        const ifr = document.getElementById("lite");
        if (ifr?.contentWindow) {
          ifr.contentWindow.postMessage({ type: "saveNotebook" }, "*");
        }
      }, 60000);
    </script>
  </body>
</html>

