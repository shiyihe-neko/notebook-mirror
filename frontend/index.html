<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ðŸ§¹ Data Cleaning Notebook</title>
    <link rel="icon" href="https://jupyter.org/favicon.ico" />
    <script src="https://unpkg.com/@jupyterlite/iframe-embed@0.4.0/dist/index.js"></script>
  </head>

  <body style="margin:0;padding:0;height:100vh;overflow:hidden;">
    <!-- âœ… è‡ªåŠ¨åŠ è½½ä½ æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹çš„ task.ipynb -->
    <iframe
      id="lite"
      src="https://jupyterlite.github.io/demo/lab/index.html?path=task.ipynb"
      style="width:100%;height:100%;border:none;"
    ></iframe>

    <script>
      // âœ… ä½ çš„åŽç«¯ï¼ˆRenderï¼‰åœ°å€ï¼šæ›¿æ¢æˆä½ éƒ¨ç½²åŽå¾—åˆ°çš„ URL
      const backendURL = "https://your-render-backend.onrender.com/upload";

      // âœ… ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆå”¯ä¸€ ID
      const participantID = "user_" + Math.random().toString(36).substring(2, 8);

      // âœ… ç›‘å¬ notebook è‡ªåŠ¨ä¿å­˜äº‹ä»¶
      window.addEventListener("message", async (event) => {
        if (!event.data || !event.data.content) return;

        if (event.data.type === "notebookSaved") {
          const notebookJSON = JSON.stringify(event.data.content);
          try {
            await fetch(backendURL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                participant_id: participantID,
                notebook_json: notebookJSON,
              }),
            });
            console.log("âœ… Notebook auto-saved to backend");
          } catch (err) {
            console.error("âŒ Save failed:", err);
          }
        }
      });

      // âœ… æ¯ 60 ç§’è‡ªåŠ¨è§¦å‘ä¿å­˜
      setInterval(() => {
        const iframe = document.getElementById("lite");
        if (iframe && iframe.contentWindow) {
          iframe.contentWindow.postMessage({ type: "saveNotebook" }, "*");
        }
      }, 60000);
    </script>
  </body>
</html>
